# AMD GPU (ROCm) override â€” Linux only
# Usage: docker compose -f docker-compose.yml -f docker-compose.amd.yml up
#
# Prerequisites:
#   - ROCm-compatible AMD GPU (RX 5000+, RX 6000+, RX 7000+, or RDNA2/3)
#   - ROCm drivers installed: https://rocm.docs.amd.com/projects/install-on-linux/en/latest/
#   - Your user in the 'video' and 'render' groups:
#       sudo usermod -aG video,render $USER
#
# Note: AMD GPU passthrough is not supported in Docker Desktop on Windows or Mac.
#       On those platforms use the default docker-compose.yml (CPU) or install Ollama natively.
#
# If your card is not auto-detected, set HSA_OVERRIDE_GFX_VERSION to match your GPU:
#   RX 5000 (Navi 10): 10.3.0
#   RX 6000 (Navi 21): 10.3.0
#   RX 7000 (Navi 31): 11.0.0
# Add it under the ollama environment block below.

services:
  ollama:
    image: ollama/ollama:rocm
    devices:
      - /dev/kfd:/dev/kfd
      - /dev/dri:/dev/dri
    group_add:
      - video
      - render
    # environment:
    #   HSA_OVERRIDE_GFX_VERSION: "11.0.0"   # uncomment if your card is not detected
